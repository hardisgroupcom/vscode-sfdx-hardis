<template>
    <div class="slds-scope slds-theme_default slds-p-around_medium blue-back">
    <lightning-card title="Salesforce Orgs Manager">
        <div slot="actions" class="slds-float_right">
            <lightning-button-group>
                <lightning-input type="toggle" label="View all orgs" title="View all orgs" checked={viewAll} onchange={handleViewAllToggle}></lightning-input>
                <span class="slds-m-left_x-small"></span>
                <lightning-button icon-name="utility:refresh" label="Refresh" title="Refresh orgs list" onclick={handleRefresh}></lightning-button>
                <span class="slds-m-left_x-small"></span>
                <lightning-button icon-name="utility:add" label="Add Org" title="Connect to existing orgs" variant="brand" onclick={handleConnect}></lightning-button>
                <span class="slds-m-left_x-small"></span>
                <template if:true={hasRecommended}>
                    <lightning-button icon-name="utility:recycle_bin_full" label="Remove recommended" variant="destructive" title="Remove recommended orgs" onclick={handleRemoveRecommended}></lightning-button>
                </template>
                <span class="slds-m-left_x-small"></span>
                <template if:true={hasSelection}>
                    <lightning-button icon-name="utility:delete" label="Forget selected" variant="destructive" title="Forget selected orgs" onclick={handleForgetSelected}></lightning-button>
                </template>
            </lightning-button-group>
        </div>
        <div class="slds-m-around_medium">
            <lightning-datatable
                key-field="username"
                data={orgs}
                columns={columns}
                onrowaction={handleRowAction}
                onrowselection={handleRowSelection}
                selected-rows={selectedRowKeys}
                class="slds-m-bottom_medium"
            ></lightning-datatable>
        </div>
    </lightning-card>
    
    <!-- Set Alias Modal -->
    <template if:true={showAliasModal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" 
                            title="Close" onclick={handleCloseAliasModal}>
                        <lightning-icon icon-name="utility:close" alternative-text="close" size="small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Set Org Alias</h2>
                </header>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <div class="slds-form-element">
                        <label class="slds-form-element__label" for="alias-input">
                            Alias for {selectedOrgForAlias.username}
                        </label>
                        <div class="slds-form-element__control">
                            <lightning-input
                                id="alias-input"
                                data-id="alias-input"
                                type="text"
                                value={aliasInputValue}
                                placeholder="Enter alias name"
                                onchange={handleAliasInputChange}
                                onkeyup={handleAliasInputKeyUp}
                                pattern="^[a-zA-Z0-9_-]+$"
                                message-when-pattern-mismatch="Alias can only contain letters, numbers, hyphens, and underscores"
                            ></lightning-input>
                        </div>
                        <template if:true={aliasError}>
                            <div class="slds-form-element__help slds-text-color_error">
                                {aliasError}
                            </div>
                        </template>
                    </div>
                </div>
                <footer class="slds-modal__footer">
                    <lightning-button
                        variant="neutral"
                        label="Cancel"
                        onclick={handleCloseAliasModal}
                    ></lightning-button>
                    <lightning-button
                        variant="brand"
                        label="Set Alias"
                        onclick={handleSetAliasConfirm}
                        disabled={isSetAliasDisabled}
                    ></lightning-button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    </div>
</template>
